function openModal(){document.getElementById("modal").style.display="block"}function closeModal(){let modal=document.getElementById("modal");modal.innerHTML="",modal.style.display=""}function pushState(url){const urls=["new","plus","minus","edit","delete","upload","language"];for(let i=0;i<urls.length;i++)if(url.includes(urls[i]))return;const context=document.getElementById("main").innerHTML,state={context:context,url:url};try{history.pushState(state,"",url)}catch(e){console.log("State is too big to save",context.length,e)}}function replaceState(url){const urls=["new","plus","minus","edit","delete","upload","language"];for(let i=0;i<urls.length;i++)if(url.includes(urls[i]))return;const context=document.getElementById("main").innerHTML,state={context:context,url:url};try{history.replaceState(state,"",url)}catch(e){console.log("State is too big to save",context.length,e)}}function cleanString(q){return(q=(q=(q=q.replace(/&+/g,"+")).replace(/\s+/g,"+")).replace(/([^a-zA-Z0-9\u0080-\uFFFF +']+)/gi,"")).toLowerCase()}function initScanner(){let el=document.createElement("video");el.id="scanner",document.getElementById("modal").appendChild(el),openModal();let scanner=new Instascan.Scanner({video:document.getElementById("scanner")});scanner.addListener("scan",function(content){$("#q").val(content),scanner.stop(),closeModal()}),Instascan.Camera.getCameras().then(function(cameras){cameras.length>0?(cameras[1]?scanner.start(cameras[1]):scanner.start(cameras[0]),$("#modal").click(function(){scanner.stop(),closeModal()})):(console.error("No cameras found."),closeModal())}).catch(function(e){console.error(e),closeModal()})}$(document).ready(function(){replaceState(window.location.href)}).on("click","#scanneron",function(e){e.preventDefault(),initScanner()}).on("change",".dropdown",function(e){e.preventDefault();const button=$(this),dump=button.data("dump"),form=button.parents("form"),url=button.data("url"),method=form.attr("method"),data=form.serialize();$.ajax({type:method,url:url,data:data}).fail(function(xhr,ajaxOptions,thrownError){console.error(thrownError)}).done(function(response){$(dump).html(response),replaceState(url),document.getElementById("errors")&&openModal()})}).on("click",".excel-button",function(e){e.preventDefault(),$(this).siblings(".excel-show").toggleClass("d-none")}).on("click",".ajax",function(e){e.preventDefault();const button=$(this),dump=button.data("dump"),form=button.parents("form");let url=button.data("url"),method,data;if(form.length){method=form.attr("method");let q=form.children("#q").val();if("GET"==method){if(!q)return;pushState(url),q=cleanString(q),url=url+"?q="+q,data=void 0}else{let price=form.find("[name=price]").val();price=price.replace(",","."),form.find("[name=price]").val(price),data=form.serialize()}}else pushState(url),method="GET",data=void 0;$.ajax({type:method,url:url,data:data}).fail(function(xhr,ajaxOptions,thrownError){console.error(thrownError)}).done(function(response){$(dump).html(response),replaceState(url),document.getElementById("errors")&&openModal()})}).on("click",".new",function(e){e.preventDefault(),$("#part0").toggleClass("toggled d-none").siblings(".toggled").removeClass("toggled").find(".toggled").toggleClass("d-none toggled"),$("#empty").toggleClass("d-none")}).on("click",".edit",function(e){e.preventDefault(),$("#part0.toggled").toggleClass("toggled d-none"),$(this).parents(".tr").siblings(".toggled").removeClass("toggled").find(".toggled").toggleClass("d-none toggled"),$(this).parents(".tr").toggleClass("toggled").find(".toggle, .edit-toggle").toggleClass("d-none toggled")}).on("click",".remove",function(e){e.preventDefault(),$("#part0.toggled").toggleClass("toggled d-none"),$(this).parents(".tr").siblings(".toggled").removeClass("toggled").find(".toggled").toggleClass("d-none toggled"),$(this).parents(".tr").toggleClass("toggled").find(".remove-toggle").toggleClass("d-none toggled")}).on("click","#modal",function(){closeModal()}).on("click",".loader",function(){$(this).children().toggleClass("d-none")}),$(window).on("popstate",function(e){const state=e.originalEvent.state;state&&$("#main").html(state.context)});